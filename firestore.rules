// DO NOT MODIFY THESE ON FIREBASE'S DASHBOARD.
// THESE RULES ARE CONTROLLED BY FILES IN A GIT REPOSITORY.
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // create and delete should be controlled by functions
    match /users/{userId} {
      allow read;

      allow update: if
        request.auth.uid != null &&
        request.path[4:5] == /$(request.auth.uid) &&
        request.resource.data.keys().hasAll(["name", "profileImageURL"]) &&
        request.resource.data.keys().hasOnly(["name", "profileImageURL"]) &&
        request.resource.data.name is string &&
        request.resource.data.name.size() >= 3 &&
        request.resource.data.name.size() < 32 &&
        request.resource.data.profileImageURL == resource.data.profileImageURL;
    }
  }
}